<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Processar e Editar Questões</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.tiny.cloud/1/wngoh8cdfbnclgn1ulvujvsb6dj9l76xarp1im1r3wt2zhh9/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
    <style>
        body {
            background-color: #f9f9f9;
            font-family: 'Roboto', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .container {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 40px;
            text-align: center;
            max-width: 800px;
            width: 100%;
            margin-bottom: 20px;
        }

        .hidden {
            display: none;
        }

        .visible {
            display: block;
        }
    </style>
</head>
<body>

<div class="container">
    <div id="uploadSection" class="visible">
        <h2>Processar e Editar Questões</h2>
        <input type="file" id="fileInput" accept=".txt" class="form-control">
        <button id="processButton" class="btn btn-primary mt-3">Processar Arquivo</button>
    </div>

    <div id="editorSection" class="hidden">
        <h2>Editor de Questões</h2><br>
        <textarea id="editorContent"></textarea><br>
        <button id="saveChanges" class="btn btn-success mt-3">Salvar Alterações</button>
    </div>
</div>

<script>
// Simulação do conteúdo do modelo.txt (para exemplo)
const modelo = `
[001] Enunciado da Questão
[002] Alternativa A
[003] Alternativa B
[004] Alternativa C
[005] Feedback
`;

document.getElementById('processButton').addEventListener('click', function() {
    var fileInput = document.getElementById('fileInput');
    var file = fileInput.files[0];

    if (file) {
        var reader = new FileReader();
        reader.onload = function(e) {
            var fileContent = e.target.result;

            // Processa o arquivo com base no modelo
            var processedContent = processarArquivo(fileContent);

            // Carrega o conteúdo processado no editor
            carregarEditor(processedContent);

            // Exibe o editor e oculta a seção de upload
            document.getElementById('uploadSection').classList.add('hidden');
            document.getElementById('editorSection').classList.remove('hidden');
        };
        reader.readAsText(file);
    } else {
        alert('Por favor, selecione um arquivo.');
    }
});

// Função para processar o arquivo com base no modelo
function processarArquivo(content) {
    var lines = content.split('\n');
    var processedContent = "";

    for (var i = 0; i < lines.length; i++) {
        let line = lines[i];
        let shortcode = '[' + ('00' + (i + 1)).slice(-3) + ']';  // Exemplo de shortcode
        processedContent += modelo.replace(/\[\d{3}\]/g, shortcode) + '\n';  // Substitui no modelo
    }

    return processedContent;
}

// Função para carregar o conteúdo no TinyMCE para edição
function carregarEditor(processedContent) {
    tinymce.init({
        selector: '#editorContent',
        height: 500,
        menubar: false,
        plugins: [
            'advlist autolink lists link image charmap print preview anchor',
            'searchreplace visualblocks code fullscreen',
            'insertdatetime media table paste code help wordcount',
            'image code'
        ],
        toolbar: 'undo redo | formatselect | bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | image | code',
        setup: function(editor) {
            editor.on('init', function() {
                tinymce.get('editorContent').setContent(processedContent);
            });
        }
    });
}

document.getElementById('saveChanges').addEventListener('click', function() {
    let updatedContent = tinymce.get('editorContent').getContent();
    let blob = new Blob([updatedContent], { type: 'text/plain' });
    let link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'questoes_editadas.txt';
    link.click();
});
</script>

</body>
</html>
