<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Editor de Questões</title>
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.tiny.cloud/1/wngoh8cdfbnclgn1ulvujvsb6dj9l76xarp1im1r3wt2zhh9/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
<style>
    body {
        background-color: #f9f9f9;
        font-family: 'Roboto', sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
    }

    #uploadBox {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 40px;
        text-align: center;
        max-width: 400px;
        width: 100%;
    }

    #uploadBox h2 {
        color: #333;
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    #fileLabel {
        background-color: #2196F3;
        border: none;
        border-radius: 4px;
        color: #fff;
        cursor: pointer;
        font-size: 16px;
        padding: 10px 20px;
        transition: background-color 0.3s ease;
        display: block;
        margin: 0 auto 20px;
        width: fit-content;
    }

    #fileLabel:hover {
        background-color: #1976D2;
    }

    #processButton {
        background-color: #4CAF50;
        border: none;
        border-radius: 4px;
        color: #fff;
        cursor: pointer;
        font-size: 16px;
        padding: 10px 20px;
        transition: background-color 0.3s ease;
        display: block;
        margin: 0 auto;
        width: fit-content;
    }

    #processButton:hover {
        background-color: #388E3C;
    }

    #uploadBox input[type="file"] {
        display: none;
    }

    .container {
        margin-top: auto;
    }

    .mt-3, .my-3 {
        margin-top: auto !important;
    }

    .question {
        margin-bottom: 20px;
    }
    
    .modal-lg { 
        max-width: 90%; 
    }

</style>
</head>
<body>
<div id="uploadBox">
    <h2>Editor de Questões</h2>
    <label id="fileLabel" for="fileInput">Escolher Arquivo</label>
    <input type="file" id="fileInput" accept=".txt">
    <button id="processButton">Abrir edição</button>
</div>

<div class="container mt-3" style="display:none">
    <h2>Editor de Questões</h2><br>
    <div id="trailContainer">
        <!-- Questões processadas serão exibidas aqui -->
    </div><br>
    <button id="downloadChanges" class="btn btn-success mt-3">Download Alterações</button>
    <br>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="processador.js"></script>
<script>
let questionsData = []; // Armazena as questões globalmente
let originalFileContent = ""; // Armazena o conteúdo original do arquivo
let isModified = false; // Flag para monitorar se o conteúdo foi modificado

$(document).ready(function() {
  $('#processButton').on('click', function() {
    const fileInput = $('#fileInput')[0].files[0];
    if (!fileInput) {
      alert('Por favor, selecione um arquivo.');
      return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
      originalFileContent = e.target.result;

      // Processar o arquivo cru com o processador.js e modelo.txt
      if (typeof processFiles === 'function') {
        processFiles([fileInput], 'nomeDaTrilha');  // Aqui o nome da trilha pode ser substituído ou configurado

        // O conteúdo final será gerado após processar o arquivo
        setTimeout(function(){
          const processedContent = processedData.join('\n'); // processedData vem do processador.js
          exibirConteudoEditavel(processedContent);
        }, 1000);
      } else {
        console.error('A função processFiles não foi definida corretamente. Verifique o script processador.js.');
      }
    };
    reader.readAsText(fileInput);
  });

  function exibirConteudoEditavel(content) {
    const trailContainer = document.getElementById('trailContainer');
    trailContainer.innerHTML = '';  // Limpar qualquer conteúdo existente

    // Dividir o conteúdo processado em questões
    const questions = content.split('// question:').slice(1);

    questions.forEach((questionText, index) => {
        const questionDiv = document.createElement('div');
        questionDiv.classList.add('question');

        const title = document.createElement('h3');
        title.innerText = `Questão ${index + 1}`;
        questionDiv.appendChild(title);

        // Exibe o texto da questão para edição
        const textArea = document.createElement('textarea');
        textArea.classList.add('form-control');
        textArea.rows = 10;
        textArea.value = questionText.trim();
        questionDiv.appendChild(textArea);

        trailContainer.appendChild(questionDiv);
    });

    // Mostra a área de edição e oculta a caixa de upload
    $('#uploadBox').hide();
    $('.container').show();
  }
});
</script>
</body>
</html>
